# Тестовое задание Leads.Tech

ТЗ: https://docs.google.com/document/d/12ia3kVyMn0WAaPzXOdRNbqKKE6YTx1MYwuELch7AaVw/edit#

## Хитрое задание

В ТЗ требуется обработать **10 000** заявок не дольше, чем за 10 минут (**600** секунд), но в то же время каждую заявку
нужно обрабатывать не быстрей, чем за **2** секунды, что в итоге займет **20 000** секунд (333 минуты :)))

## Решение

Выход есть - нам придется распараллелить работу в отдельных процессах.

В Java это делается элегантно в легковесных `Threads`, здесь же, чтобы сильно не заморачиваться, реализуем это через
`pcntl_fork` и общую очередь сообщений `SysvMessageQueue`. Основной процесс помещает в очередь лиды, а дочерние достают
из нее по одному и обрабатывают.

### Сколько нам потребуется параллельных процессов:

`кол-во потоков = 10 000 * 2 сек / 10 / 60 сек = 34`

А чтобы гарантированно успеть в заданное время, учитывая возможные лаги (задержки) в системе, округлим кол-во процессов
до **50**, и получим систему заданной производительности. Примерное время обработки составит **7 минут**.

Можно было бы подумать над использованием серверов очередей и прочее, но избыточный инжиниринг это тоже плохо, и для
данной задачи вполне достаточно подручных средств.

### Запуск

#### Локально:

```shell
./run
```

#### Docker (https://hub.docker.com/r/dicrtarasov/leads-test):

```shell
docker run -it dicrtarasov/leads-test
```

### Результаты работы

```
Обработка завершена (отправлено: 10000 лидов, время работы: 06:47)
```

При работе создается лог-файл: `/run.log` (видно что id идут не по порядку, потому как процессы обрабатывают очередь
асинхронно):

```
9990|Pizza|2021-08-04 04:07:55
9989|Get loan|2021-08-04 04:07:55
9993|Cleaning|2021-08-04 04:07:55
9992|Pizza|2021-08-04 04:07:55
9997|Get loan|2021-08-04 04:07:55
9994|Repair smth|2021-08-04 04:07:55
9995|Pizza|2021-08-04 04:07:55
9996|Pizza|2021-08-04 04:07:55
9998|Buy auto|2021-08-04 04:07:55
9999|Pizza|2021-08-04 04:07:55
10000|Buy house|2021-08-04 04:07:55
```

_P.S. Ваше задание заставило меня улыбнуться и подарило интеллектуальное наслаждение :)_
